<link rel="import" href="../geohash-js/geohash-js.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

  <dom-module id="geo-hash-data">

    <template>
      <iron-ajax url="{{input}}" last-response="{{data}}" auto></iron-ajax>
    </template>
    
    <script>
      
(function() {
  Polymer({
    is: 'geo-hash-data',
    properties: {
      output: {
        computed: "process(data)"
      },
      input: {
        type: String,
        value: "https://essentialhotels.co.uk/index.json"
      },
      count: {
        type: Number,
        value:0
      }
    },
    process: function(data) {
      var output = {};
      var count = this.count;
      //
      if (data != null) {
        Object.keys(data).forEach(function(key) {
          if (data[key].hasOwnProperty("LatLng")) { 
            
            console.log(key, data[key].LatLng);
            
            var latlng = data[key].LatLng.split(",");
            output = this.add(data[key],encodeGeoHash(+latlng[1], +latlng[0]),output);
            console.log(encodeGeoHash(+latlng[1], +latlng[0]));
            count++; 
          }
        });
      }
      //this.count = count;
      console.log(output);
      // encodeGeoHash(+lng, +lat);
      return {
        num: count,
        output: output
      };
    },
    add : function(newData,key,output,path) {
      debugger;
      if (key.length > 1) {
        var keys = key.match(/.{1,2}/g);
        var thisKey = keys[0];
        var path = keys.splice(1).join("");
        console.log("thisKey",thisKey);
        console.log("Keys",newkeys);
        if (!output.hasOwnProperty(thisKey)) {
          output[thisKey] = {};
        }
        return add(newData,key,output[thisKey],path);
      } else {
        
        return add(newData,key,output,path);
      }
    }
  });
})();
    </script>
  </dom-module>
